stages:
  - lint
  - analyze
  - build
  - coverage
  - sanitizers
  - release

variables:
  # --- Компиляторы и базовый образ ---
  CC: clang                     # Системный C-компилятор по умолчанию.
  CXX: clang++                  # Системный C++-компилятор по умолчанию.
  CI_BASE_IMAGE: "ubuntu:22.04" # Docker-образ для Linux-джобов.

  # --- Базовые пакеты и Python-зависимости ---
  APT_PACKAGES: >-              # Список пакетов APT, ставится во всех Linux-джобах.
    python3 python3-pip ninja-build clang clang-tidy clang-format
    pkg-config gcc g++ llvm ccache
  PIP_PACKAGES: "meson gcovr"   # Питон-пакеты для сборки и покрытия.

  # --- Кэширование ---
  CCACHE_DIR: .cache/ccache     # Путь к кэшу ccache в рабочем каталоге job.
  CCACHE_MAX_SIZE: "500M"       # Ограничение размера кэша ccache.

  # --- Таймауты/тесты ---
  CI_TEST_TIMEOUT_MULTIPLIER: "1" # Множитель таймаута тестов (увеличивать на медленных раннерах).
  # Примечание: GitLab не подставляет переменные в timeout/expire_in, поэтому таймауты и TTL заданы прямо в job (20m/30m и 1 week).

  # --- Переключатели платформ/инструментов ---
  CI_RUN_MACOS: "false"    # Включить macOS сборки (нужен runner с тегом macos).
  CI_RUN_WINDOWS: "false"  # Включить Windows сборки (нужен runner с тегом windows).
  CI_RUN_TSAN: "false"     # Включить TSan (нужен runner, где TSan работает).

include:
  - local: .gitlab/includes/setup_meson_env.yml
  - local: .gitlab/includes/build_templates.yml
  - local: .gitlab/workflows/ci.yml
  - local: .gitlab/workflows/coverage.yml
  - local: .gitlab/workflows/sanitizers.yml
  - local: .gitlab/workflows/release.yml
